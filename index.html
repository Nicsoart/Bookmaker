<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Офферы</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Стили остаются прежними */
        body { font-family: Arial; padding: 15px; background: #f5f5f5; }
        .offers { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .offer { background: white; border-radius: 12px; padding: 15px; text-align: center; }
        .offer img { width: 60px; height: 60px; object-fit: contain; }
    </style>
</head>
<body>
    <div id="app">
        <h2>Выберите оффер</h2>
        <div class="offers">
            <div class="offer" data-url="https://telegram.org">
                <img src="https://cdn-icons-png.flaticon.com/512/2111/2111644.png" alt="Telegram">
                <p>Telegram.org</p>
            </div>
            <div class="offer" data-url="https://core.telegram.org">
                <img src="https://cdn-icons-png.flaticon.com/512/5968/5968804.png" alt="API">
                <p>Telegram API</p>
            </div>
        </div>
    </div>

    <script>
        // 1. Жёсткая проверка Telegram WebApp
        const isTelegram = () => {
            return window.Telegram && Telegram.WebApp && 
                   Telegram.WebApp.initData || /TelegramWebApp/i.test(navigator.userAgent);
        };

        // 2. Универсальное открытие ссылки
        const openInApp = (url) => {
            if (!isTelegram()) {
                alert("Запустите в Telegram для правильной работы");
                return;
            }
            
            try {
                Telegram.WebApp.openLink(url, {
                    try_instant_view: true,
                    instant_view: true
                });
            } catch (e) {
                // Экстренный fallback
                window.location.href = `tg://proxy?url=${encodeURIComponent(url)}`;
            }
        };

        // 3. Инициализация
        if (isTelegram()) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            document.querySelectorAll('.offer').forEach(el => {
                el.addEventListener('click', () => {
                    openInApp(el.getAttribute('data-url'));
                });
            });
        } else {
            document.body.innerHTML = '<h1>Запустите в Telegram!</h1>';
        }
    </script>
</body>
</html>
