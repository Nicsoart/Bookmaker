<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Офферы</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Ваши стили остаются без изменений */
        body { font-family: Arial; padding: 15px; background: #f5f5f5; }
        .offers { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .offer { background: white; border-radius: 12px; padding: 15px; text-align: center; }
        .offer img { width: 60px; height: 60px; object-fit: contain; }
    </style>
</head>
<body>
    <div id="app">
        <h2>Выберите оффер</h2>
        <div class="offers">
            <div class="offer" data-url="https://example.com/offer1">
                <img src="icon1.png" alt="Оффер 1">
                <p>Бонус 100%</p>
            </div>
            <!-- Другие офферы -->
        </div>
    </div>

    <script>
        const tg = Telegram.WebApp;
        
        // 1. Инициализация
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();

        // 2. Проверка поддержки WebView
        function isTelegramWebView() {
            return navigator.userAgent.includes('TelegramWebApp');
        }

        // 3. Универсальный обработчик ссылок
        document.querySelectorAll('.offer').forEach(offer => {
            offer.addEventListener('click', () => {
                const url = offer.getAttribute('data-url');
                
                if (isTelegramWebView()) {
                    // Способ 1: Основной метод
                    if (tg.openLink) {
                        tg.openLink(url, { 
                            try_instant_view: true,
                            instant_view: true
                        });
                    }
                    // Способ 2: Для старых версий
                    else if (tg.openTelegramLink) {
                        tg.openTelegramLink(url);
                    }
                    // Способ 3: Крайний случай
                    else {
                        window.location.href = url;
                    }
                } else {
                    // Для теста вне Telegram
                    alert("В Telegram откроется внутри приложения: " + url);
                }
            });
        });

        // 4. Кнопка "Назад"
        tg.BackButton.show();
        tg.onEvent('backButtonClicked', tg.close);
    </script>
</body>
</html>
